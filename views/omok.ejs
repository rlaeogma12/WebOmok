<!doctype html>
<html>
  <head>
    <title>오목 플레이</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="assets/css/omok.css">
  </head>
  <body>
  오목 플레이
  <br>



  <fieldset>
  User ID : <input type="text" id="userid" value = '손님' readonly/>
  <button id='change_id'>아이디 변경</button>
  </fieldset>

  <fieldset>
    Game Infomation
    <div class="wait container">
      <br><br>
      상대방을 기다리고 있습니다..
    </div>

    <div class="info container">
      <br>
      현재 턴 : <input type="text" id="current_Turn" value="흑" readonly/>
      <br>
      남은 시간 : <input type="text" id="left_Time" value="10" readonly/>
      <br>
      내 돌의 색깔 : <input type="text" id="my_color" value="흑" readonly/>
    </div>



  </fieldset>


  <div class="chat container">
  <fieldset>
  <br>
  <textarea id="chat_content" cols="40" rows="8" readonly></textarea>

  <br>
  <input type='chat_msg' id="chat_msg">
  <button id="chat_submit">전송</button>
  </fieldset>
  </div>


  <div class="game container" id="stonelocate">
  <img id='omokpan' src="../images/omok.jpg"/>
  <table id='omoktable' width='721' height='721' cellspacing='0' border='0' cellpadding='0' style="table-layout:fixed; border-collapse; position:relative; left:7px; bottom:720px;">
    <script>
    for(i=0; i<19; i++){
      document.write("<tr>");
      for(j=0;j<19;j++){
        document.write("<td width='37' height='37' id='tableLocation"+(i*19+j)+"'  onclick='setstone("+i+","+j+")'></td>");
      }
      document.write("</tr>");
    }

    tableObj = document.getElementById('omoktable');
    tableObj_td = tableObj.getElementsByTagName('td');

    for(i=0;i<tableObj_td.length;i++) {
      tableObj_td[i].onmouseover = function() {
        this.style.background = "white";
      }
      tableObj_td[i].onmouseout = function() {
        this.style.background = "transparent";
      }
    }
    function setstone(row, col){
      var img = document.createElement('img');
      img.setAttribute("src", "../images/black.png");
      img.setAttribute("alt", "Stone");

      img.style.position = "relative";
      img.width = 40;
      img.height = 40;

      tableObj.rows[row].cells[col].appendChild(img);
    }
    </script>
  </table>
  </div>


  <!-- script part -->
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <!--
  <script src="../assets/js/chat.js"></script>
  -->
  <script>
  var connected = false;
  var userID = $('#userid').val();
  var room = '';

  function show_game_window(username){
    $('#userid').val(username);
    userID = username;

    $('.wait').hide();
    $('.info').show();
    $('.chat').show();
    $('.game').show();
  }

  function hide_game_window(){
    $('.wait').show();
    $('.info').hide();
    $('.chat').hide();
    $('.game').hide();
  }

  $(document).ready(function() {
    // Socket.io connection

    var socket = io();

    socket.on('connect', function(data){
      connected = true;
      //Request random Matching
      socket.emit('requestRandomRoom');
      hide_game_window();
    });

    //Matching Complete
    socket.on('completeMatch', function(data){
      room = data.room;
      show_game_window(data.username);
      $("#chat_content").append("플레이어 숫자가 2명이 되었습니다.\n게임을 시작합니다.");
      $("#my_color").val(data.usercolor);
    });

    //Matching Ended
    socket.on('endMatch', function(data){
      hide_game_window();
      socket.leave(room);
      room = '';
    });

    //disconnection
    socket.on('disconnect', function(data){
      console.log('Connection Fell');
    });

    // Receive a message
    socket.on('message', function(data) {
      $('#chat_content').append('\n' + data.userid + ' : ' + data.message);
      const top = $('#chat_content').prop('scrollHeight');
      $('#chat_content').scrollTop(top);
    });

    //Change Turn
    socket.on('turnChange', function(data){
      $('#chat_content').append('\n' + '|턴이 변경되었습니다.|');
      const top = $('#chat_content').prop('scrollHeight');
      $('#chat_content').scrollTop(top);
    });

    // send a message
    $("#chat_submit").click(function() {
      var msg = $('#chat_msg').val();
      if(!msg) return;
      socket.emit('message', {
        userid : userID,
        message: msg
      });
      $('#chat_msg').val('');
    });
    //by enter
    $('#chat_msg').keyup(function(e){
      if(e.keyCode == 13){
        $("#chat_submit").trigger('click');
      }
    });

    //change nickname
    $('#change_id').click(function(){
      var newID = prompt('바꿀 아이디를 입력하세요.', '손님2');
      if(newID){
        $('#userid').val(newID);
        userID = newID;
      }
    });
  });
  </script>


  </body>
</html>
